(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-chat"],{"0f5f":function(t,e,i){"use strict";var a=i("7be0"),n=i.n(a);n.a},"2fb5":function(t,e,i){t.exports=i.p+"static/img/Vector-1.f353a102.svg"},"34ee":function(t,e,i){var a=i("24fb"),n=i("1de5"),o=i("7135"),c=i("e875"),s=i("9076"),r=i("2fb5");e=a(!1);var l=n(o),d=n(c),u=n(s),h=n(r);e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 下方引入的为uView UI的集成样式文件，为scss预处理器，其中包含了一些"u-"开头的自定义变量\r\n * 使用的时候，请将下面的一行复制到您的uniapp项目根目录的uni.scss中即可\r\n * uView自定义的css类名和scss变量，均以"u-"开头，不会造成冲突，请放心使用 \r\n */.deleteSession[data-v-d699385a]{padding:20px;display:flex;flex-direction:column;width:300px}.deleteSession .confirm-title[data-v-d699385a]{font-size:20px}.deleteSession .confirm-msg[data-v-d699385a]{margin:30px 0}.deleteSession .confirm-btn[data-v-d699385a]{display:flex;align-items:center;justify-content:space-between;-webkit-user-select:none;user-select:none}.deleteSession .confirm-btn .confirm-cancel[data-v-d699385a]{background:#e7fcf9}.deleteSession .confirm-btn .confirm-ok[data-v-d699385a]{color:#fff;background:#fe4f2f}.deleteSession .confirm-btn > *[data-v-d699385a]{padding:10px 30px;cursor:pointer;border-radius:10px}.model-wrapper[data-v-d699385a]{display:flex;align-items:center;border-radius:20px;position:relative;z-index:1;font-size:12px;color:#888;flex:1;margin-right:20px}.model-wrapper .model-select[data-v-d699385a]{margin-right:10px;cursor:pointer}.model-wrapper .models[data-v-d699385a]{padding:10px;position:absolute;background:#fff;bottom:100%;box-shadow:0 0 8px rgba(0,0,0,.1);margin-bottom:4px;border-radius:5px;outline:none;padding:6px}.model-wrapper .models .model-item[data-v-d699385a]{font-size:13px;display:flex;align-items:center;padding:5px 6px;border-radius:3px}.model-wrapper .models .model-item[data-v-d699385a]:hover{background:#e7fcf9}.model-wrapper .models .model-item .label[data-v-d699385a]{margin-right:20px;flex:1}.model-wrapper .models .model-item[data-v-d699385a]:not(:last-child){margin-bottom:3px}.model-wrapper .models .model-item .check[data-v-d699385a]{color:#42cbbb}.model-wrapper .model-value[data-v-d699385a]{display:inline-flex;align-items:center;padding:5px 14px;border-radius:90px;box-shadow:0 0 8px rgba(0,0,0,.1)}.model-wrapper .model-value .value[data-v-d699385a]{margin-right:5px}.chat-page[data-v-d699385a]{height:100%;display:flex;flex-direction:column;background-image:url('+l+");background-size:100% auto;background-position:0 top;background-repeat:no-repeat;position:relative}.chat-info[data-v-d699385a]{padding:10px 20px}.chat-info .role-info[data-v-d699385a]{display:flex;align-items:center}.chat-info .role-info .role-portrait[data-v-d699385a]{width:40px;height:40px;border-radius:50%;background-position:50%;background-repeat:no-repeat;background-size:contain;margin:0 6px 0 10px;border:2px solid #fff}.chat-info .role-info .role-portrait.robot[data-v-d699385a]{background-image:url("+d+')!important}.chat-info .role-info .role-name[data-v-d699385a]{font-size:18px;flex:1}.chat-info .role-info .switch-role[data-v-d699385a]{padding:10px 13px;background:#fff;color:#42cbbb;border-radius:25px;display:flex;align-items:center;line-height:1}.chat-info .role-info .switch-role .gpticon-switch[data-v-d699385a]{margin-right:5px}.chat-info .chat-desc[data-v-d699385a]{margin-top:10px;color:#3d3d60;line-height:1.6em;font-size:12px}.chat-list[data-v-d699385a]{flex:1;overflow-y:auto;background:#fff;border-radius:20px 20px 0 0;padding:25px 0 20px;box-shadow:0 2px 2px rgba(0,0,0,.05) inset}.chat-list .chat-item[data-v-d699385a]{display:flex;padding:10px}.chat-list .chat-item img[data-v-d699385a]{max-width:100%}.chat-list .chat-item.Self[data-v-d699385a]{flex-direction:row-reverse}.chat-list .chat-item.Self .toolbtns[data-v-d699385a]{justify-content:end}.chat-list .chat-item.Self .chat-content[data-v-d699385a]{margin-right:12px}.chat-list .chat-item.Others .chat-content[data-v-d699385a]{margin-left:12px}.chat-list .toolbtns[data-v-d699385a]{position:relative;display:flex;align-items:center;padding-top:8px;-webkit-column-gap:12px;column-gap:12px}.chat-list .chat-edit[data-v-d699385a]{background:#f5f5f5;width:32px;height:32px;min-width:32px;min-height:32px;display:flex;align-self:start;border-radius:50%;align-items:center;justify-content:center;flex-direction:column;color:#777;font-size:11px;line-height:1em}.chat-list .chat-edit[data-v-d699385a]:after{display:inline-block;-webkit-transform:scale(.7);transform:scale(.7)}.chat-list .chat-edit.gpticon-edit[data-v-d699385a]:after{content:"编辑";font-size:12px}.chat-list .chat-edit.gpticon-copy[data-v-d699385a]:after{content:"复制";font-size:12px}.chat-list .chat-edit.gpticon-voice[data-v-d699385a]:after{content:"语音";font-size:12px}.chat-list .chat-edit.gpticon-delete[data-v-d699385a]:after{content:"清空";font-size:12px}.chat-list .chat-edit.gpticon-star[data-v-d699385a]:after{content:"收藏";font-size:12px}.chat-list .chat-edit.gpticon-star[data-v-d699385a]::before{background-image:url('+u+');background-size:12px;background-position:50%;background-repeat:no-repeat}.chat-list .chat-edit.gpticon-stared[data-v-d699385a]:after{content:"收藏";font-size:12px;color:#fe4f2f}.chat-list .chat-edit.gpticon-stared[data-v-d699385a]::before{background-image:url('+h+');background-size:12px;background-color:#fff;background-position:50%;background-repeat:no-repeat}.chat-list .chat-edit.gpticon-stop[data-v-d699385a]:after{content:"终止";font-size:12px}.chat-list .chat-edit.stop[data-v-d699385a]{color:red}.chat-list .chat-edit.collected[data-v-d699385a]{color:red}.chat-list .chat-edit.collect[data-v-d699385a]{color:red}.chat-list .protrait[data-v-d699385a]{width:25px;height:25px;min-width:25px;min-height:25px;background-size:cover;background-repeat:no-repeat;background-position:50%;border-radius:50%}.chat-list .protrait.robot[data-v-d699385a]{background-image:url('+d+")!important}",""]),t.exports=e},"5f08":function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this.$createElement,e=this._self._c||t;return e("v-uni-view",{staticStyle:{display:"none"}})},n=[]},"7be0":function(t,e,i){var a=i("34ee");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=i("4f06").default;n("dcc313f4",a,!0,{sourceMap:!1,shadowMode:!1})},"7da3":function(t,e,i){"use strict";i("7a82");var a=i("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,o=a(i("c7eb")),c=a(i("1da1"));i("d3b7"),i("159b"),i("e9c4"),i("d401"),i("25f0"),i("14d9");var s={name:"socket-item",props:{socketurl:{type:String,default:""}},data:function(){return{}},mounted:function(){var t=this;this.$nextTick((function(){t.init(t.socketurl)}))},beforeDestroy:function(){n.close()},computed:{},methods:{init:function(t){var e=this;n=uni.connectSocket({url:t,data:function(){return{msg:"Hello"}},success:function(t){},fail:function(t){}}),n.onMessage((function(t){var i=JSON.parse(t.data),a=i.data,n="";switch(n=a.contentType?a.contentType:"image",n){case"text":e.onReciveText(a);break;case"image":e.onReciveImage(a);break;case"audio":e.onReciveAudio(a);break;default:break}}))},onReciveText:function(t){var e=new Date,i={speaker:"Others",text:t.text,contentType:"text",createTime:e.getTime(),isUndo:!1,isDelete:!1};this.$emit("ontext",{data:i})},onReciveImage:function(t){var e=this;t.forEach(function(){var t=(0,c.default)((0,o.default)().mark((function t(i,a){var n;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n="http://47.100.189.197/downloadchat/image/?url="+i.imageSrc,t.next=3,uni.downloadFile({url:n,success:function(t){i.imageSrc=t.tempFilePath;var a={speaker:i.speaker,contentType:i.contentType,imageSrc:i.imageSrc,createTime:i.createTime,isUndo:i.isUndo,isDelete:i.isDelete};e.$emit("onimage",{data:a})}});case 3:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}())},onReciveAudio:function(t){var e=this,i="http://47.100.189.197/downloadchat/audio/?url="+t.audioSrc;uni.downloadFile({url:i,success:function(i){t.audioSrc=i.tempFilePath,e.$emit("onaudio",{data:t})}})},sendTextMsg:function(t){var e={};e["data"]=t,n.send({data:JSON.stringify(e),success:function(t){},fail:function(t){}})},sendImageMsg:function(t){var e=[],i=[],a=new Date,o={};t.forEach((function(t,e){var a=new Object;a.uri=t,a.name=e.toString(),i.push(a)})),uni.uploadFile({url:"http://47.100.189.197/uploadchat/image/",files:i,formData:{count:t.length,userid:"3"},method:"POST",success:function(t){var i=JSON.parse(t.data),c=i.imageList;c.forEach((function(t,i){var n={speaker:"Others",contentType:"image",imageSrc:t,createTime:a.getTime(),isUndo:!1,isDelete:!1};e.push(n)})),o["data"]=e,n.send({data:JSON.stringify(o),success:function(t){},fail:function(t){}})}})},sendAudioMsg:function(t){var e={};uni.uploadFile({url:"http://47.100.189.197/uploadchat/audio/",filePath:t.audioSrc,name:"audiofile",formData:{userid:"3"},method:"POST",success:function(i){var a=JSON.parse(i.data),o=a.audiopath,c={speaker:"Others",contentType:t.contentType,audioSrc:o,createTime:t.createTime,isUndo:t.isUndo,isDelete:t.isDelete};e["data"]=c,n.send({data:JSON.stringify(e),success:function(t){},fail:function(t){}})}})},sendUndoMsg:function(){}}};e.default=s},9076:function(t,e,i){t.exports=i.p+"static/img/Vector.6dcf019f.svg"},"9d91":function(t,e,i){"use strict";i.r(e);var a=i("5f08"),n=i("f0eb");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);var c=i("f0c5"),s=Object(c["a"])(n["default"],a["b"],a["c"],!1,null,"e9f1fde4",null,!1,a["a"],void 0);e["default"]=s.exports},a2e6:function(t,e,i){"use strict";i.r(e);var a=i("c6e6"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},abca:function(t,e,i){"use strict";i.r(e);var a=i("f180"),n=i("a2e6");for(var o in n)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(o);i("0f5f");var c=i("f0c5"),s=Object(c["a"])(n["default"],a["b"],a["c"],!1,null,"d699385a",null,!1,a["a"],void 0);e["default"]=s.exports},c6e6:function(t,i,a){"use strict";a("7a82");var n=a("4ea4").default;Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0,a("4de4"),a("d3b7"),a("7db0"),a("14d9"),a("d401"),a("25f0"),a("159b"),a("99af"),a("ac1f"),a("466d"),a("a434"),a("e25e"),a("5319"),a("5b81");var o,c=n(a("ade3")),s=n(a("c7eb")),r=n(a("1da1")),l=a("9133"),d=n(a("ba67")),u=n(a("2361")),h=n(a("b982")),f=n(a("9d91")),p=(n(a("a57b")),a("3cbe")),v=n(a("0208")),m=null,g=null,x=null,w=(o={name:"easyChat",components:{chatItem:u.default},data:function(){return{deleIdx:0,isShowDele:!1,pageTitle:"",isLoading:!1,activeIndex:0,socketUrl:"",timeStr:"",clickMic:!1,scrollview:"",inputcontent:"",bottomHeight:10,micHeight:255,formatedRecordTime:"00:00:00",recordTime:0,isShowTips:!1,isRecording:!1,isCancel:!1,socketTask:null,form:{},chatList:[],screenWidth:0,_audioContext:null,options:{},isVoice:!1,context:v.default,showRoleList:!1,chatType:"",model_id:null,initMsg:"",models:[],currentModel:null,selectModel:!1,showDelete:!1,showCollect:!1,showCollectId:0,showModels:!1,isChecking:!1}},onLoad:function(t){var e=this;return(0,r.default)((0,s.default)().mark((function i(){var a,n;return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return e.model_id=t.id,e.initMsg=t.msg,e.chatType=t.type,i.next=5,e.$onLaunched;case 5:return e.isVoice=uni.getStorageSync("isVoice"),e.screenWidth=uni.getStorageSync("screenWidth"),e.pageTitle=uni.getStorageSync("pageTitle")||"聊天",uni.setNavigationBarTitle({title:e.pageTitle}),e.getInfo(),i.next=12,e.$u.post("/hxai/api/chat/getchatset");case 12:a=i.sent,a&&(e.models=a.data.chatmodel.filter((function(t){return t.status})),e.showModels=1==a.data.chatmodel_status,n=uni.getStorageSync("chatmodel"),n&&(e.currentModel=e.models.find((function(t){return t.type==n}))),e.currentModel||(e.currentModel=e.models[0]));case 14:case"end":return i.stop()}}),i)})))()},mounted:function(){var t=this;this.$nextTick((function(){m=uni.getRecorderManager(),m.onStart((function(){g=setInterval((function(){t.recordTime+=1,t.formatedRecordTime=t.recordTime}),1e3)})),m.onStop((function(e){if(t.isCancel)t.formatedRecordTime="00:00:00",t.isCancel=!1,t.recordTime=0;else if(t.recordTime<1)t.formatedRecordTime="00:00:00",t.recordTime=0,uni.showToast({icon:"none",title:"发送时间太短",duration:1e3});else{t.recordTime=0;var i=new Date,a={speaker:"Self",contentType:"audio",audioSrc:e.tempFilePath,createTime:i.getTime(),isUndo:!1,isDelete:!1};t.chatList.push(a);var n="dynamic_"+(t.chatList.length-1>-1?t.chatList.length-1:0).toString();t.$nextTick((function(){t.scrollview=n,t.formatedRecordTime="00:00:00"})),t.$refs.socket.sendAudioMsg(a)}}))})),uni.onKeyboardHeightChange((function(e){t.scrollview="null";var i="dynamic_"+(t.chatList.length-1>-1?t.chatList.length-1:0).toString();e.height>0?(t.$nextTick((function(){t.scrollview=i})),t.bottomHeight=e.height):t.$nextTick((function(){t.bottomHeight=10}))}))}},(0,c.default)(o,"components",{popup:d.default,chatItem:u.default,uniIcons:h.default,socketItem:f.default}),(0,c.default)(o,"computed",{getImageList:function(){var t=[];return this.chatList.forEach((function(e,i){"image"==e.contentType&&t.push(e.imageSrc)}),this),t},getScrollView:function(){return this.scrollview},setButtonBg:function(){return this.isRecording?"bg-blue":"bg-gray"}}),(0,c.default)(o,"watch",{chatList:{deep:!0,handler:function(t,e){var i=this;this.$nextTick((function(){return i.scrollToBottom()}))}},inputcontent:function(t){uni.setStorageSync("lastChatVal",t)}}),(0,c.default)(o,"methods",{save:function(){var t=this;return(0,r.default)((0,s.default)().mark((function e(){var i;return(0,s.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t.chatType,"12222"),"content"!=t.chatType){e.next=7;break}return e.next=4,t.$u.api.createDele({model_id:t.model_id});case 4:i=e.sent,e.next=16;break;case 7:if("chat"!=t.chatType){e.next=13;break}return e.next=10,t.$u.api.chatDele({model_id:t.model_id});case 10:i=e.sent,e.next=16;break;case 13:return e.next=15,t.$u.api.assistDele({model_id:t.model_id});case 15:i=e.sent;case 16:i&&(t.isShowDele=!1,t.chatList=[],t.getDataList());case 17:case"end":return e.stop()}}),e)})))()},playVoice:function(t){var e=this;return(0,r.default)((0,s.default)().mark((function i(){return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:e._audioContext&&e._audioContext.pause(),e._audioContext=null,e.createAudio(t);case 3:case"end":return i.stop()}}),i)})))()},createAudio:function(t){var e=this._audioContext=uni.createInnerAudioContext();return e.autoplay=!1,e.src=t,this._audioContext.play(),e},getVoice:function(t){var e=this;return(0,r.default)((0,s.default)().mark((function i(){var a,n;return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=document.querySelector("#dynamic_".concat(t)),i.next=3,e.$u.api.chatVoice({content:a.textContent});case 3:n=i.sent,n&&e.playVoice(n.data);case 5:case"end":return i.stop()}}),i)})))()},goBack:function(){uni.navigateBack({delta:1})},getInfo:function(){var t=this;return(0,r.default)((0,s.default)().mark((function e(){var i;return(0,s.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=null,"content"!=t.chatType){e.next=7;break}return e.next=4,t.$u.api.createInfo({id:t.model_id});case 4:i=e.sent,e.next=14;break;case 7:if("chat"==t.chatType){e.next=13;break}return e.next=10,t.$u.api.assistInfo({id:t.model_id});case 10:i=e.sent,e.next=14;break;case 13:t.form=null;case 14:i&&(t.form=i.data),t.getDataList();case 16:case"end":return e.stop()}}),e)})))()},getDataList:function(){var t=this;return(0,r.default)((0,s.default)().mark((function e(){var i,a,n,o,c;return(0,s.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("content"!=t.chatType){e.next=6;break}return e.next=3,t.$u.api.createChatList({model_id:t.model_id});case 3:i=e.sent,e.next=15;break;case 6:if("chat"!=t.chatType){e.next=12;break}return e.next=9,t.$u.api.chatList();case 9:i=e.sent,e.next=15;break;case 12:return e.next=14,t.$u.api.assistChatList({model_id:t.model_id});case 14:i=e.sent;case 15:i&&(a=new Date,n={},t.chatList=[],i.data.forEach((function(e){n="我"==e.role?{id:e.id||0,status:e.status||0,speaker:"Self",contentType:"text",text:e.content,createTime:a.getTime(),isUndo:!1,isDelete:!1}:{id:e.id||0,status:e.status||0,speaker:"Others",contentType:"text",text:e.content,createTime:a.getTime(),isUndo:!1,isDelete:!1},t.chatList.push(n)})),0==t.chatList.length&&"chat"!=t.chatType&&(c=uni.getStorageSync("welcome"),t.chatList.push({speaker:"Others",contentType:"text",text:(null===(o=t.form)||void 0===o?void 0:o.hint_content)||c,createTime:a.getTime(),isUndo:!1,isDelete:!1})),"chat"==t.chatType&&t.initMsg?(t.sendMessage(t.initMsg),t.initMsg=""):t.inputcontent=uni.getStorageSync("lastChatVal")||"",t.$nextTick((function(){t.$refs.chatListView&&(t.$refs.chatListView.$el.scrollTop=1e6)})));case 16:case"end":return e.stop()}}),e)})))()},getData:function(t){var e,i,a=this;this.isLoading=!0,i="content"==this.chatType?"".concat(p.host,"/hxai/api/createchat/send?model_id=").concat(this.model_id,"&message=").concat(t):"chat"==this.chatType?this.currentModel?"".concat(p.host,"/hxai/api/chat/send?message=").concat(t,"&chatmodel=").concat(this.currentModel.type):"".concat(p.host,"/hxai/api/chat/send?message=").concat(t):"".concat(p.host,"/hxai/api/rolechat/send?model_id=").concat(this.model_id,"&message=").concat(t),null===(e=x)||void 0===e||e.close(),x=new l.EventSourcePolyfill(i,{headers:{wid:uni.getStorageSync("wid")||"1",token:uni.getStorageSync("clitoken")||""}});var n={speaker:"Others",contentType:"text",text:"",createTime:(new Date).getTime(),isUndo:!1,isDelete:!1,loading:!0};x.onopen=function(t){a.chatList.push(n),a.$nextTick((function(){a.scrollToBottom()}))},x.onmessage=function(t){console.log(t.data),n.text+=t.data},x.onerror=function(t){x.close(),n.createTime=(new Date).getTime(),n.loading=!1,a.isLoading=!1,a.getDataList()}},scrollToBottom:function(){this.$refs.chatListView&&(this.$refs.chatListView.$el.scrollTop=1e6)},sendMessage:function(t){var e=this;return(0,r.default)((0,s.default)().mark((function i(){var a,n,o;return(0,s.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e.isLoading&&!e.isChecking){i.next=2;break}return i.abrupt("return");case 2:if(v.default.userInfo){i.next=5;break}return e.$u.api.configWechat().then((function(t){if(t&&t.data){var e=window.navigator.userAgent.toLowerCase(),i="micromessenger"==e.match(/MicroMessenger/i);i?uni.navigateTo({url:"/pages/wechatLogin/wechatLogin?redirect="+encodeURIComponent(location.href)}):uni.navigateTo({url:"/pages/login/login"})}})).catch((function(t){uni.navigateTo({url:"/pages/login/login"})})),i.abrupt("return");case 5:a="",a="string"==typeof t?t:t.detail.value,n=new Date,a&&(o={text:a},"chat"==e.chatType?o.type="chat":(o.type="content"==e.chatType?"createchat":"rolechat",o.model_id=e.model_id),e.chatList.push({speaker:"Self",contentType:"text",text:a,createTime:n.getTime(),isUndo:!1,isDelete:!1}),e.isChecking=!0,e.$u.api.chatCheck(o).then((function(t){if(t)if(1!=t.data.code){var i="dynamic_"+(e.chatList.length-1>-1?e.chatList.length-1:0).toString();e.$nextTick((function(){e.inputcontent="",e.scrollview=i})),e.getData(t.data.text)}else e.$nextTick((function(){e.inputcontent="",e.scrollview=id})),e.$u.toast(t.data.text);else e.chatList.splice(e.chatList.length-1,1)})).catch((function(t){"无效的token"!=t.data.msg&&uni.navigateTo({url:"/pages/subscribe/subscribe?viptip=".concat(t.data.msg)})})).finally((function(){e.isChecking=!1})));case 9:case"end":return i.stop()}}),i)})))()},micHide:function(){this.bottomHeight=0,this.clickMic=!1},micTouchStart:function(t){this.isRecording=!0,m.start({format:"mp3"})},micTouchMove:function(t){},micTouchEnd:function(t){this.isRecording=!1,clearInterval(g),m.stop(),this.$refs.tips.hide()},undo:function(t){var e=parseInt(t.index);this.chatList[e].isUndo=!0},deleted:function(t){this.deleIdx=parseInt(t),this.isShowDele=!0},onReciveMessages:function(t){},stopChat:function(t){x.close(),t.loading=!1,this.isLoading=!1},ontext:function(t){var e=this,i=t.data;this.chatList.push(i);var a="dynamic_"+(this.chatList.length-1>-1?this.chatList.length-1:0).toString();this.$nextTick((function(){e.scrollview=a}))},onimage:function(t){var e=this,i=t.data;this.chatList.push(i);var a="dynamic_"+(this.chatList.length-1>-1?this.chatList.length-1:0).toString();setTimeout((function(){e.scrollview=a}),500)},onaudio:function(t){var e=this,i=t.data;this.chatList.push(i);var a="dynamic_"+(this.chatList.length-1>-1?this.chatList.length-1:0).toString();setTimeout((function(){e.scrollview=a}),500)},reEdit:function(t){this.inputcontent=t},copy:function(t){var e=t.replaceAll("<br/>","\n");e=e.replaceAll("&nbsp;"," "),uni.setClipboardData({data:e,success:function(){}})},switchRole:function(t){this.showRoleList=!1,this.chatType="rolechat",this.model_id=t.id,this.getInfo()},selectM:function(){var t=this;this.selectModel=!0,this.$nextTick((function(){t.$refs.modelDrop.$el.focus()}))},chooseModel:function(t){this.currentModel=t,uni.setStorageSync("chatmodel",t.type)},deleteSession:function(){var t=this;console.log(this.chatType,"this.chatType"),"rolechat"==this.chatType||"assist"==this.chatType?this.$u.api.assistDele({model_id:this.model_id}).then((function(e){t.showDelete=!1,t.chatList=[],t.getDataList()})).catch((function(t){console.log(t)})):this.$u.api.chatDele().then((function(){t.showDelete=!1,t.chatList=[],t.getDataList()})).catch((function(){console.log(e)}))},onclickCollect:function(t){var e=this;console.log(this.chatType,"this.chatType"),console.log(t,"item"),1==t.status?(this.showCollectId=t.id||0,this.showCollect=!0):"content"==this.chatType?this.$u.api.createCollect({model_id:this.model_id,collect_id:t.id||0}).then((function(i){e.$u.toast(i.msg),e.showCollect=!1;var a=e.chatList;a.forEach((function(e,i){e.id==t.id&&(1==e.status?a[i].status=0:a[i].status=1)})),e.chatList=a})).catch((function(t){console.log(t)})):"rolechat"==this.chatType||"assist"==this.chatType?this.$u.api.assistCollect({model_id:this.model_id,collect_id:t.id||0}).then((function(i){e.$u.toast(i.msg),e.showCollect=!1;var a=e.chatList;a.forEach((function(e,i){e.id==t.id&&(1==e.status?a[i].status=0:a[i].status=1)})),e.chatList=a})).catch((function(t){console.log(t)})):this.$u.api.chatCollect({model_id:this.model_id,collect_id:t.id||0}).then((function(i){e.$u.toast(i.msg),e.showCollect=!1;var a=e.chatList;a.forEach((function(e,i){e.id==t.id&&(1==e.status?a[i].status=0:a[i].status=1)})),e.chatList=a})).catch((function(t){console.log(t)}))},collectSession:function(){var t=this;return(0,r.default)((0,s.default)().mark((function e(){return(0,s.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("rolechat"!=t.chatType&&"assist"!=t.chatType){e.next=6;break}return e.next=3,t.$u.api.assistCollect({model_id:t.model_id,collect_id:t.showCollectId||0}).then((function(e){t.$u.toast(e.msg),t.showCollect=!1;var i=t.chatList;i.forEach((function(e,a){e.id==t.showCollectId&&(1==e.status?i[a].status=0:i[a].status=1)})),t.chatList=i})).catch((function(t){console.log(t)}));case 3:e.sent,e.next=15;break;case 6:if("content"!=t.chatType){e.next=12;break}return e.next=9,t.$u.api.createCollect({model_id:t.model_id,collect_id:t.showCollectId||0}).then((function(e){t.$u.toast(e.msg),t.showCollect=!1;var i=t.chatList;i.forEach((function(e,a){e.id==t.showCollectId&&(1==e.status?i[a].status=0:i[a].status=1)})),t.chatList=i})).catch((function(t){console.log(t)}));case 9:e.sent,e.next=15;break;case 12:return e.next=14,t.$u.api.chatCollect({model_id:t.model_id,collect_id:t.showCollectId||0}).then((function(e){t.$u.toast(e.msg),t.showCollect=!1;var i=t.chatList;i.forEach((function(e,a){e.id==t.showCollectId&&(1==e.status?i[a].status=0:i[a].status=1)})),t.chatList=i})).catch((function(t){console.log(t)}));case 14:e.sent;case 15:case"end":return e.stop()}}),e)})))()}}),o);i.default=w},f0eb:function(t,e,i){"use strict";i.r(e);var a=i("7da3"),n=i.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},f180:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var a={chatItem:i("2361").default,popup:i("ba67").default,uniIcons:i("b982").default,uPopup:i("cfd9").default},n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"chat-page"},[i("v-uni-view",{staticClass:"chat-info"},[i("v-uni-view",{staticClass:"role-info"},[i("v-uni-view",{staticClass:"back-icon gpticon-back",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goBack.apply(void 0,arguments)}}}),"chat"==t.chatType?[i("v-uni-view",{staticClass:"role-portrait robot"}),i("v-uni-view",{staticClass:"role-name"},[t._v("智能AI助手")])]:t._e(),t.form?[i("v-uni-view",{staticClass:"role-portrait",style:{backgroundImage:"url("+t.form.tp_url+")"}}),i("v-uni-view",{staticClass:"role-name"},[t._v(t._s(t.form.title))])]:t._e(),i("v-uni-view",{staticClass:"switch-role",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showRoleList=!0}}},[i("v-uni-view",{staticClass:"gpticon-switch"}),i("v-uni-view",[t._v("切换角色")])],1)],2),t.form&&t.form.desc?i("v-uni-view",{staticClass:"chat-desc"},[t._v(t._s(t.form.desc))]):t._e()],1),i("v-uni-view",{ref:"chatListView",staticClass:"chat-list",attrs:{"scroll-into-view":t.getScrollView}},t._l(t.chatList,(function(e,a){return 0==e.isDelete?i("v-uni-view",{key:a,staticClass:"chat-item",class:e.speaker},[t.form?i("v-uni-view",{staticClass:"protrait",style:{backgroundImage:"url("+("Self"==e.speaker?(t.context.userInfo||{}).headimgurl:t.form.tp_url)+")"}}):i("v-uni-view",{staticClass:"protrait",class:{robot:"Self"!=e.speaker},style:{backgroundImage:"url("+("Self"==e.speaker?(t.context.userInfo||{}).headimgurl:"")+")"}}),i("div",{staticClass:"chat-content"},[i("chat-item",{attrs:{dynamicId:a.toString()+e.createTime,speaker:e.speaker,text:e.text,isLoading:a==t.chatList.length-1&&t.isLoading,contentType:e.contentType,imageSrc:e.imageSrc,imageList:t.getImageList,audioSrc:e.audioSrc,createTime:e.createTime,isUndo:e.isUndo}}),i("div",{staticClass:"toolbtns"},["Self"==e.speaker?i("v-uni-view",{staticClass:"chat-edit gpticon-edit",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.reEdit(e.text)}}}):[e.loading?i("v-uni-view",{staticClass:"chat-edit stop gpticon-stop",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.stopChat(e)}}}):[i("v-uni-view",{staticClass:"chat-edit copy gpticon-copy",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.copy(e.text)}}}),1==t.isVoice?i("v-uni-view",{staticClass:"chat-edit voice gpticon-voice",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.getVoice(""+a+e.createTime)}}}):t._e(),i("v-uni-view",{staticClass:"chat-edit delete gpticon-delete",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showDelete=!0}}}),e.status&&1==e.status?i("v-uni-view",{staticClass:"chat-edit icon-star gpticon-stared",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.onclickCollect(e)}}}):i("v-uni-view",{staticClass:"chat-edit icon-star gpticon-star",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.onclickCollect(e)}}})]]],2)],1)],1):t._e()})),1),i("v-uni-view",{staticClass:"large-chat-input-wrapper",staticStyle:{"margin-top":"0"}},[i("v-uni-view",{staticClass:"input-wrapper"},[i("v-uni-textarea",{staticClass:"input-body",attrs:{maxlength:"4000",rows:"4",placeholder:"输入您想问的...","confirm-type":"send"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.sendMessage.apply(void 0,arguments)}},model:{value:t.inputcontent,callback:function(e){t.inputcontent="string"===typeof e?e.trim():e},expression:"inputcontent"}})],1),i("div",{staticClass:"chat-config-wrapper"},[i("v-uni-view",{staticClass:"model-wrapper"},[t.showModels&&t.currentModel?[i("v-uni-view",{staticClass:"model-select"},[t.selectModel?i("v-uni-view",{ref:"modelDrop",staticClass:"models",attrs:{tabindex:"1"},on:{blur:function(e){arguments[0]=e=t.$handleEvent(e),t.selectModel=!1}}},t._l(t.models,(function(e){return i("v-uni-view",{staticClass:"model-item",attrs:{tabindex:"1"},on:{mousedown:function(i){arguments[0]=i=t.$handleEvent(i),t.chooseModel(e)}}},[i("v-uni-view",{staticClass:"label"},[t._v(t._s(e.nickname))]),t.currentModel==e?i("v-uni-view",{staticClass:"check gpticon-check"}):t._e()],1)})),1):t._e(),i("v-uni-view",{staticClass:"model-value",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.selectM.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"value"},[t._v(t._s(t.currentModel.nickname))]),i("v-uni-view",{staticClass:"select-icon gpticon-drop"})],1)],1),i("v-uni-view",[t._v(t._s(t.currentModel.expend)+t._s(t.context.unit)+"/次")])]:t._e()],2),i("v-uni-view",{staticClass:"send-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendMessage(t.inputcontent)}}},[t._v("发送")])],1)],1),i("roleListPage",{attrs:{show:t.showRoleList},on:{close:function(e){arguments[0]=e=t.$handleEvent(e),t.showRoleList=!1},select:function(e){arguments[0]=e=t.$handleEvent(e),t.switchRole.apply(void 0,arguments)}}}),i("popup",{ref:"micpop",attrs:{maskColor:!1,bottom:!0,bodyBgColor:"bg-white",id:"micpop"},on:{hide:function(e){arguments[0]=e=t.$handleEvent(e),t.micHide.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"col-1",staticStyle:{height:"100%"}},[i("v-uni-view",{staticClass:"flex align-center justify-center text-xl",staticStyle:{height:"20%"}},[t._v(t._s(t.formatedRecordTime))]),i("v-uni-view",{staticClass:"flex align-center justify-center",staticStyle:{height:"50%"}},[i("v-uni-button",{staticClass:"cu-btn cuIcon  shadow",class:t.setButtonBg,staticStyle:{width:"100px",height:"100px"},attrs:{id:"micbutton"},on:{touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.micTouchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.micTouchEnd.apply(void 0,arguments)},touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.micTouchStart.apply(void 0,arguments)}}},[i("uni-icons",{attrs:{type:"mic",size:"40"}})],1)],1),0==t.isRecording?i("v-uni-view",{staticClass:"flex align-center justify-center text-xl",staticStyle:{height:"20%"}},[t._v("点击录音")]):t._e(),1==t.isRecording?i("v-uni-view",{staticClass:"flex align-center justify-center text-xl",staticStyle:{height:"20%"}},[t._v("向上滑动取消")]):t._e()],1)],1),i("popup",{ref:"tips",attrs:{maskColor:!1,center:!0,bodyBgColor:"bg-white",mask:!1}},[i("v-uni-view",{staticClass:"col-1 radius",staticStyle:{width:"125px",height:"125px","background-color":"rgba(113,113,113,0.7)"}},[i("v-uni-view",{staticClass:"flex align-center justify-center ",staticStyle:{height:"50%","margin-top":"15px"}},[i("uni-icons",{attrs:{type:"refreshempty",size:"60"}})],1),i("v-uni-view",{staticClass:"flex justify-center align-center ",staticStyle:{color:"#ffffff"}},[t._v("松手取消发送")])],1)],1),i("u-popup",{attrs:{mode:"center","border-radius":"10"},model:{value:t.showDelete,callback:function(e){t.showDelete=e},expression:"showDelete"}},[i("v-uni-view",{staticClass:"deleteSession"},[i("v-uni-view",{staticClass:"confirm-title"},[t._v("您确定要清除所有聊天记录?")]),i("v-uni-view",{staticClass:"confirm-msg"},[t._v("将清空所有对话中的聊天内容，此操作无法恢复。")]),i("v-uni-view",{staticClass:"confirm-btn"},[i("v-uni-view",{staticClass:"confirm-cancel",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showDelete=!1}}},[t._v("取消")]),i("v-uni-view",{staticClass:"confirm-ok",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.deleteSession.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1),i("u-popup",{attrs:{mode:"center","border-radius":"10"},model:{value:t.showCollect,callback:function(e){t.showCollect=e},expression:"showCollect"}},[i("v-uni-view",{staticClass:"deleteSession"},[i("v-uni-view",{staticClass:"confirm-title"},[t._v("您确定要取消收藏吗?")]),i("v-uni-view",{staticClass:"confirm-msg"},[t._v("取消收藏后，可能再也找不到了哦。")]),i("v-uni-view",{staticClass:"confirm-btn"},[i("v-uni-view",{staticClass:"confirm-cancel",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.showCollect=!1}}},[t._v("取消")]),i("v-uni-view",{staticClass:"confirm-ok",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.collectSession.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],1)},o=[]}}]);