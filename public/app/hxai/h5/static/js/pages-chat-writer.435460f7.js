(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-writer"],{1708:function(e,t,a){var n=a("242e");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var o=a("4f06").default;o("2af30bf9",n,!0,{sourceMap:!1,shadowMode:!1})},"242e":function(e,t,a){var n=a("24fb"),o=a("1de5"),i=a("7135"),c=a("e875"),r=a("9076"),s=a("2fb5");t=n(!1);var l=o(i),d=o(c),p=o(r),u=o(s);t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 下方引入的为uView UI的集成样式文件，为scss预处理器，其中包含了一些"u-"开头的自定义变量\r\n * 使用的时候，请将下面的一行复制到您的uniapp项目根目录的uni.scss中即可\r\n * uView自定义的css类名和scss变量，均以"u-"开头，不会造成冲突，请放心使用 \r\n */.chat-page[data-v-53f0a4e0]{height:100%;display:flex;flex-direction:column;background-image:url('+l+");background-size:100% auto;background-position:0 top;background-repeat:no-repeat;position:relative}.chat-page .deleteSession[data-v-53f0a4e0]{padding:20px;display:flex;flex-direction:column;width:300px}.chat-page .deleteSession .confirm-title[data-v-53f0a4e0]{font-size:20px}.chat-page .deleteSession .confirm-msg[data-v-53f0a4e0]{margin:30px 0}.chat-page .deleteSession .confirm-btn[data-v-53f0a4e0]{display:flex;align-items:center;justify-content:space-between;-webkit-user-select:none;user-select:none}.chat-page .deleteSession .confirm-btn .confirm-cancel[data-v-53f0a4e0]{background:#e7fcf9}.chat-page .deleteSession .confirm-btn .confirm-ok[data-v-53f0a4e0]{color:#fff;background:#fe4f2f}.chat-page .deleteSession .confirm-btn > *[data-v-53f0a4e0]{padding:10px 30px;cursor:pointer;border-radius:10px}.chat-page .chat-config-wrapper[data-v-53f0a4e0]{display:flex;align-items:center;padding:0 0 10px}.chat-page .chat-config-wrapper .model-wrapper[data-v-53f0a4e0]{display:flex;align-items:center;border-radius:20px;position:relative;z-index:1;font-size:12px;color:#888;flex:1;margin-right:20px;justify-content:space-between}.chat-page .chat-config-wrapper .model-wrapper .model-select[data-v-53f0a4e0]{margin-right:10px;cursor:pointer}.chat-page .chat-config-wrapper .model-wrapper .models[data-v-53f0a4e0]{padding:10px;position:absolute;background:#fff;bottom:100%;box-shadow:0 0 8px rgba(0,0,0,.1);margin-bottom:4px;border-radius:5px;outline:none;padding:6px}.chat-page .chat-config-wrapper .model-wrapper .models .model-item[data-v-53f0a4e0]{font-size:13px;display:flex;align-items:center;padding:5px 6px;border-radius:3px}.chat-page .chat-config-wrapper .model-wrapper .models .model-item[data-v-53f0a4e0]:hover{background:#e7fcf9}.chat-page .chat-config-wrapper .model-wrapper .models .model-item .label[data-v-53f0a4e0]{margin-right:20px;flex:1}.chat-page .chat-config-wrapper .model-wrapper .models .model-item[data-v-53f0a4e0]:not(:last-child){margin-bottom:3px}.chat-page .chat-config-wrapper .model-wrapper .models .model-item .check[data-v-53f0a4e0]{color:#42cbbb}.chat-page .chat-config-wrapper .model-wrapper .model-value[data-v-53f0a4e0]{display:inline-flex;align-items:center;padding:5px 14px;border-radius:90px;box-shadow:0 0 8px rgba(0,0,0,.1)}.chat-page .chat-config-wrapper .model-wrapper .model-value .value[data-v-53f0a4e0]{margin-right:5px}.chat-page .page-content[data-v-53f0a4e0]{padding:20px;overflow-y:auto;flex:1}.chat-page .writer-title[data-v-53f0a4e0]{color:#3d3d60;font-size:18px;margin-bottom:12px;margin-left:15px;font-weight:400}.chat-page uni-textarea[data-v-53f0a4e0]{background:#fff;border-radius:20px;width:100%;margin-bottom:20px;padding:15px;box-sizing:border-box;font-size:.9em;height:80px}.chat-page .btns[data-v-53f0a4e0]{display:flex;align-items:center;margin-bottom:20px}.chat-page .btns uni-button[data-v-53f0a4e0]{border-radius:70px;border:none;padding:16px 25px;line-height:1;font-size:16px}.chat-page .btns uni-button[data-v-53f0a4e0]::after, .chat-page .btns uni-button[data-v-53f0a4e0]::before{display:none}.chat-page .btns uni-button .icon[data-v-53f0a4e0]{display:inline-block;margin-right:10px;position:relative;top:2px}.chat-page .btns .clear[data-v-53f0a4e0]{border:1px solid #d9d9d9;color:#888}@-webkit-keyframes rotate-data-v-53f0a4e0{0%{-webkit-transform:rotate(0) scale(1.2);transform:rotate(0) scale(1.2)}100%{-webkit-transform:rotate(1turn) scale(1.2);transform:rotate(1turn) scale(1.2)}}@keyframes rotate-data-v-53f0a4e0{0%{-webkit-transform:rotate(0) scale(1.2);transform:rotate(0) scale(1.2)}100%{-webkit-transform:rotate(1turn) scale(1.2);transform:rotate(1turn) scale(1.2)}}.chat-page .btns .save[data-v-53f0a4e0]{margin-left:20px;flex:1;background:linear-gradient(95.9deg,#9fffbe -.66%,#0cffec 101.97%)}.chat-page .btns .save .gpticon-loading[data-v-53f0a4e0]{-webkit-animation:rotate-data-v-53f0a4e0 2s linear infinite;animation:rotate-data-v-53f0a4e0 2s linear infinite}.chat-page .content-wrapper[data-v-53f0a4e0]{border-radius:20px;background:linear-gradient(95.9deg,rgba(159,255,190,.2) -.66%,rgba(12,255,236,.2) 101.97%)}.chat-page .content-wrapper .content-box[data-v-53f0a4e0]{padding:15px;display:flex;align-items:start}.chat-page .content-wrapper .content[data-v-53f0a4e0]{display:flex;align-items:start;padding:0 15px;flex:1;word-break:break-all}.chat-page .content-wrapper .protrait[data-v-53f0a4e0]{border-radius:50%;width:30px;height:30px;min-width:30px;min-height:30px;margin-right:10px;background-repeat:no-repeat;background-position:50%;background-size:cover;background-image:url("+d+")}.chat-page .content-wrapper .content-q[data-v-53f0a4e0]{color:#6d8287}.chat-page .content-wrapper .content-a[data-v-53f0a4e0]{font-size:14px;color:#6d8287}.chat-page .content-wrapper .a-wrapper[data-v-53f0a4e0]{border-radius:20px;background:#fff;border:1px solid #9fffbe}.chat-page .content-wrapper .a-btns[data-v-53f0a4e0]{display:flex;justify-content:end;padding:0 20px 20px}.chat-page .content-wrapper .a-btns > *[data-v-53f0a4e0]{border-radius:30px;padding:6px 10px;font-size:12px;line-height:1.4em}.chat-page .content-wrapper .a-btns > *[data-v-53f0a4e0]:before{margin-right:3px;position:relative;top:2px}.chat-page .content-wrapper .a-btns .a-rewrite[data-v-53f0a4e0]{margin-left:15px;background:#dbfcef;color:#78bf8f}.chat-page .content-wrapper .a-btns .a-copy[data-v-53f0a4e0]{margin-left:15px;color:#ccab93;background:#fff3ea}.chat-page .content-wrapper .a-btns .gpticon-star[data-v-53f0a4e0]::before{background-position:50%;background-repeat:no-repeat;background-image:url("+p+");background-size:12px}.chat-page .content-wrapper .a-btns .gpticon-star[data-v-53f0a4e0]{background-color:#f7f7f7;font-size:12px;margin-left:15px}.chat-page .content-wrapper .a-btns .gpticon-stared[data-v-53f0a4e0]{background-color:#f7f7f7;font-size:12px;color:#fe4f2f}.chat-page .content-wrapper .a-btns .gpticon-stared[data-v-53f0a4e0]::before{background-image:url("+u+");background-size:12px;background-color:#fff;background-position:50%;background-repeat:no-repeat}.chat-page .content-wrapper .a-btns.collected[data-v-53f0a4e0]{color:red}.chat-page .content-wrapper .a-btns.collect[data-v-53f0a4e0]{color:red}",""]),e.exports=t},"2b1a":function(e,t,a){"use strict";var n=a("1708"),o=a.n(n);o.a},"2fb5":function(e,t,a){e.exports=a.p+"static/img/Vector-1.f353a102.svg"},"32b2":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n={uPopup:a("cfd9").default},o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"chat-page"},[a("v-uni-view",{staticClass:"page-header"},[a("v-uni-view",{staticClass:"back-icon gpticon-back",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.goBack.apply(void 0,arguments)}}}),a("v-uni-view",{staticClass:"page-title"})],1),a("v-uni-view",{ref:"pageContent",staticClass:"page-content"},[a("v-uni-view",{staticClass:"writer-title"},[e._v(e._s(e.form.title))]),a("v-uni-textarea",{attrs:{rows:"4",placeholder:e.placeholder,maxlength:"4000"},model:{value:e.message,callback:function(t){e.message="string"===typeof t?t.trim():t},expression:"message"}}),a("div",{staticClass:"chat-config-wrapper"},[a("v-uni-view",{staticClass:"model-wrapper"},[e.currentModel&&e.showModels?[a("v-uni-view",{staticClass:"model-select"},[e.selectModel?a("v-uni-view",{ref:"modelDrop",staticClass:"models",attrs:{tabindex:"1"},on:{blur:function(t){arguments[0]=t=e.$handleEvent(t),e.selectModel=!1}}},e._l(e.models,(function(t){return a("v-uni-view",{staticClass:"model-item",attrs:{tabindex:"1"},on:{mousedown:function(a){arguments[0]=a=e.$handleEvent(a),e.chooseModel(t)}}},[a("v-uni-view",{staticClass:"label"},[e._v(e._s(t.nickname))]),e.currentModel==t?a("v-uni-view",{staticClass:"check gpticon-check"}):e._e()],1)})),1):e._e(),a("v-uni-view",{staticClass:"model-value",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.selectM.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"value"},[e._v(e._s(e.currentModel.nickname))]),a("v-uni-view",{staticClass:"select-icon gpticon-drop"})],1)],1),a("v-uni-view",[e._v(e._s(e.currentModel.expend)+e._s(e.context.unit)+"/次")])]:e._e()],2)],1),a("v-uni-view",{staticClass:"btns"},[a("v-uni-button",{staticClass:"clear",attrs:{disabled:e.isLoading},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.message=""}}},[a("span",{staticClass:"gpticon-delete icon"}),a("span",[e._v("清空输入")])]),e.isLoading?a("v-uni-button",{staticClass:"save",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.stopWriting.apply(void 0,arguments)}}},[e.isLoading?a("span",{staticClass:"gpticon-loading icon"}):e._e(),a("span",[e._v("终止创作")])]):a("v-uni-button",{staticClass:"save",attrs:{disabled:e.isLoading||!e.message||e.isChecking},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sendMessage(e.message)}}},[e.isLoading?a("span",{staticClass:"gpticon-loading icon"}):e._e(),a("span",[e._v("开始创作")])])],1),e.answer||e.question?a("v-uni-view",{staticClass:"content-wrapper"},[e.question?a("v-uni-view",{staticClass:"content-box content-q"},[a("v-uni-view",{staticClass:"protrait q-protrait",style:{backgroundImage:"url("+e.userInfo.headimgurl+")"}}),a("v-uni-view",{staticClass:"content q-content"},[e._v(e._s(e.question.content))])],1):e._e(),e.answer?a("v-uni-view",{staticClass:"a-wrapper"},[a("v-uni-view",{staticClass:"content-box content-a"},[a("v-uni-view",{staticClass:"protrait a-protrait"}),a("v-uni-view",{staticClass:"mdcontent",domProps:{innerHTML:e._s(e.mdContenxt(e.answer.content))}})],1),e.isLoading?e._e():a("v-uni-view",{staticClass:"a-btns"},[e.answer.status&&1==e.answer.status?a("v-uni-view",{staticClass:"icon-star gpticon-stared",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onclickCollect(e.answer)}}},[e._v("收藏")]):a("v-uni-view",{staticClass:"icon-star gpticon-star",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.onclickCollect(e.answer)}}},[e._v("收藏")]),e.question?a("v-uni-view",{staticClass:"a-rewrite gpticon-reload",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sendMessage(e.question.content),e.message=e.question.content}}},[e._v("重新创作")]):e._e(),e.answer?a("v-uni-view",{staticClass:"a-copy gpticon-copy",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.copy(e.answer.content)}}},[e._v("复制文案")]):e._e()],1)],1):e._e()],1):e._e()],1),a("u-popup",{attrs:{mode:"center","border-radius":"10"},model:{value:e.showCollect,callback:function(t){e.showCollect=t},expression:"showCollect"}},[a("v-uni-view",{staticClass:"deleteSession"},[a("v-uni-view",{staticClass:"confirm-title"},[e._v("您确定要取消收藏?")]),a("v-uni-view",{staticClass:"confirm-msg"},[e._v("取消收藏后，可能再也找不到了哦。")]),a("v-uni-view",{staticClass:"confirm-btn"},[a("v-uni-view",{staticClass:"confirm-cancel",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showCollect=!1}}},[e._v("取消")]),a("v-uni-view",{staticClass:"confirm-ok",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.collectSession.apply(void 0,arguments)}}},[e._v("确定")])],1)],1)],1)],1)},i=[]},9076:function(e,t,a){e.exports=a.p+"static/img/Vector.6dcf019f.svg"},e95f:function(e,t,a){"use strict";a.r(t);var n=a("f308"),o=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},ec2c:function(e,t,a){"use strict";a.r(t);var n=a("32b2"),o=a("e95f");for(var i in o)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(i);a("2b1a");var c=a("f0c5"),r=Object(c["a"])(o["default"],n["b"],n["c"],!1,null,"53f0a4e0",null,!1,n["a"],void 0);t["default"]=r.exports},f308:function(e,t,a){"use strict";a("7a82");var n=a("4ea4").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("4de4"),a("d3b7"),a("7db0"),a("99af"),a("14d9"),a("ac1f"),a("5319"),a("5b81"),a("159b");var o=n(a("c7eb")),i=n(a("1da1")),c=n(a("ade3")),r=(n(a("ba67")),n(a("2361"))),s=(n(a("a57b")),a("3cbe")),l=a("9133"),d=n(a("a9c7")),p=n(a("0208")),u=null,f={name:"easyChat",components:{chatItem:r.default},data:function(){var e;return e={chatList:[],model_id:null,form:{},message:"",placeholder:"",isLoading:!1,userInfo:{}},(0,c.default)(e,"model_id",null),(0,c.default)(e,"models",[]),(0,c.default)(e,"currentModel",null),(0,c.default)(e,"selectModel",!1),(0,c.default)(e,"context",p.default),(0,c.default)(e,"isChecking",!1),(0,c.default)(e,"showCollect",!1),(0,c.default)(e,"showCollectId",0),(0,c.default)(e,"showModels",!1),e},onLoad:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.model_id=e.id,t.placeholder=e.msg,t.getInfo(),a.next=5,t.$u.api.userInfo();case 5:t.userInfo=a.sent,t.userInfo=(null===(n=t.userInfo)||void 0===n?void 0:n.data)||{},t.$u.post("/hxai/api/chat/getchatset").then((function(e){if(e){t.models=e.data.chatmodel.filter((function(e){return e.status})),t.showModels=1==e.data.chatmodel_status;var a=uni.getStorageSync("chatmodel");a&&(t.currentModel=t.models.find((function(e){return e.type==a}))),t.currentModel||(t.currentModel=t.models[0])}}));case 8:case"end":return a.stop()}}),a)})))()},computed:{answer:function(){var e=this.chatList.filter((function(e){return"我"!=e.role}));return e.length?e.pop():null},question:function(){var e=this.chatList.filter((function(e){return"我"==e.role}));return e.length?e.pop():null}},methods:{mdContenxt:function(e){return d.default.render(e)},save:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$u.api.createDele({model_id:e.model_id});case 2:a=t.sent,a&&(e.chatList=[],e.getDataList());case 4:case"end":return t.stop()}}),t)})))()},goBack:function(){uni.navigateBack({delta:1})},getInfo:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$u.api.createInfo({id:e.model_id}).then((function(t){e.form=t.data})),e.getDataList();case 2:case"end":return t.stop()}}),t)})))()},getDataList:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$u.api.createChatList({model_id:e.model_id});case 2:a=t.sent,e.chatList=a.data;case 4:case"end":return t.stop()}}),t)})))()},getData:function(e){var t,a=this,n="".concat(s.host,"/hxai/api/createchat/send?model_id=").concat(this.model_id,"&message=").concat(e,"&chatmodel=").concat(null===(t=this.currentModel)||void 0===t?void 0:t.type);u=new l.EventSourcePolyfill(n,{headers:{wid:uni.getStorageSync("wid")||"1",token:uni.getStorageSync("clitoken")||""}});var o={speaker:"Others",contentType:"text",content:""};u.onopen=function(e){var t=new Date;a.isLoading=!0,o.createTime=t.getTime(),a.chatList.push(o),a.$nextTick((function(){a.scrollToBottom()}))},u.onmessage=function(e){a.$nextTick((function(){o.content+=e.data,a.scrollToBottom()}))},u.onerror=function(e){u.close(),a.isLoading=!1,a.getDataList(),a.$nextTick((function(){a.scrollToBottom()}))}},scrollToBottom:function(){this.$refs.pageContent&&this.$refs.pageContent.$el.scrollTo({top:1e6,behavior:"smooth"})},sendMessage:function(e){var t=this;return(0,i.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(p.default.userInfo){a.next=3;break}return uni.navigateTo({url:"/pages/login/login"}),a.abrupt("return");case 3:n=new Date,!e||t.isLoading||t.isChecking||(t.isChecking=!0,t.$u.api.chatCheck({text:e,type:"createchat",model_id:t.model_id}).then((function(e){e&&(1!=e.data.code?(t.chatList.push({role:"我",speaker:"Self",contentType:"text",content:e.data.text,createTime:n.getTime()}),t.getData(e.data.text)):t.$u.toast(e.data.text))})).catch((function(e){"无效的token"!=e.data.msg&&uni.navigateTo({url:"/pages/subscribe/subscribe?viptip=".concat(e.data.msg)})})).finally((function(){t.isChecking=!1})));case 5:case"end":return a.stop()}}),a)})))()},copy:function(e){var t=e.replaceAll("<br/>","\n");t=t.replaceAll("&nbsp;"," "),uni.setClipboardData({data:t,success:function(){}})},stopWriting:function(){this.isLoading=!1,u.close()},selectM:function(){var e=this;this.selectModel=!0,this.$nextTick((function(){e.$refs.modelDrop.$el.focus()}))},chooseModel:function(e){this.currentModel=e,uni.setStorageSync("chatmodel",e.type)},onclickCollect:function(e){var t=this;console.log(this.chatType,"this.chatType"),console.log(e,"item"),1==e.status?(this.showCollectId=e.id||0,this.showCollect=!0):this.$u.api.createCollect({model_id:this.model_id,collect_id:e.id||0}).then((function(a){t.$u.toast(a.msg),t.showCollect=!1;var n=t.chatList;n.forEach((function(t,a){t.id==e.id&&(1==t.status?n[a].status=0:n[a].status=1)})),t.chatList=n})).catch((function(e){console.log(e)}))},collectSession:function(){var e=this;return(0,i.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$u.api.createCollect({model_id:e.model_id,collect_id:e.showCollectId||0}).then((function(t){e.$u.toast(t.msg),e.showCollect=!1;var a=e.chatList;a.forEach((function(t,n){t.id==e.showCollectId&&(1==t.status?a[n].status=0:a[n].status=1)})),e.chatList=a})).catch((function(e){console.log(e)}));case 2:t.sent;case 3:case"end":return t.stop()}}),t)})))()}}};t.default=f}}]);