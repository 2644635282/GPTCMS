(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-paint-paint"],{"1afd":function(t,e,n){var i=n("bc78");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=n("4f06").default;a("d0145620",i,!0,{sourceMap:!1,shadowMode:!1})},"5f08":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){}));var i=function(){var t=this.$createElement,e=this._self._c||t;return e("v-uni-view",{staticStyle:{display:"none"}})},a=[]},6901:function(t,e,n){"use strict";n.r(e);var i=n("746b"),a=n("8e19");for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);n("f0eb9");var r=n("f0c5"),s=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"90369f7c",null,!1,i["a"],void 0);e["default"]=s.exports},"746b":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return i}));var i={uniIcons:n("b982").default,chatItem:n("2361").default,popup:n("ba67").default,uPopup:n("cfd9").default},a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"s-back"},[n("v-uni-view",{staticClass:"s-back"},[n("v-uni-view",{staticClass:"s-back",staticStyle:{position:"absolute"}},[n("v-uni-view",{staticClass:"s-back"},[n("v-uni-view",{staticClass:"index-line1",staticStyle:{color:"#fff"}},[n("v-uni-view",{staticStyle:{width:"80px"}},[n("uni-icons",{attrs:{type:"back",size:"25",color:"#fff"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goBack.apply(void 0,arguments)}}})],1),n("v-uni-view",{staticClass:"index2"},[t._v(t._s(t.pageTitle))]),n("v-uni-view",{staticClass:"index3"},[n("v-uni-view",{staticStyle:{width:"90px",height:"10px"}})],1)],1),n("v-uni-scroll-view",{staticClass:"scrollView",style:{background:"#1A2134",paddingBottom:"20px",width:t.screenWidth+"px",height:t.screenHeight-t.bottomHeight-110+"px",position:"relative"},attrs:{"scroll-y":"true","scroll-x":"true","scroll-top":t.scrollTopHeight,"show-scrollbar":"true","scroll-into-view":t.getScrollView,"scroll-with-animation":"true"}},[n("v-uni-view",{attrs:{id:"scroll-view-content"}},t._l(t.chatList,(function(e,i){return 0==e.isDelete?n("v-uni-view",{key:i,class:"Self"==e.speaker?"index-flex-right":"index-flex-left"},["Self"==e.speaker&&e.isUndo?n("div",{staticClass:"index-no"},[t._v("!")]):t._e(),n("chat-item",{attrs:{dynamicId:i.toString(),speaker:e.speaker,text:e.text,textTemp:t.textTemp,isLoading:i==t.chatList.length-1&&t.isLoading,contentType:e.contentType,imageSrc:e.imageSrc,imageList:t.getImageList,audioSrc:e.audioSrc,createTime:e.createTime,isUndo:e.isUndo},on:{undo:function(e){arguments[0]=e=t.$handleEvent(e),t.undo.apply(void 0,arguments)},delete:function(e){arguments[0]=e=t.$handleEvent(e),t.deleted.apply(void 0,arguments)}}}),"Others"==e.speaker&&1==t.isVoice?n("div",{staticClass:"index-mt12"},[n("v-uni-image",{staticStyle:{width:"50px",height:"50px"},attrs:{src:"/static/img/voice.png"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.getVoice(i)}}})],1):t._e()],1):t._e()})),1),n("div",{staticStyle:{width:"100%",height:"40px"}})],1)],1),n("v-uni-view",{staticClass:"bottomClass1",staticStyle:{"background-color":"rgb(21, 21, 32)"},style:"position: absolute;bottom:"+(-44).toString()+"px;left:0;right:0;width:auto;"},[n("v-uni-view",{staticClass:"index-inp uni-row uni-flex",staticStyle:{"align-content":"center","justify-content":"center"}},[n("div",{staticClass:"example1 out"},[n("div",{staticClass:"inputClass in"},[n("v-uni-input",{ref:"inputRef",staticClass:"index-inp-inner",staticStyle:{"font-size":"30rpx"},attrs:{placeholder:"输入您想问的...","confirm-type":"send","cursor-spacing":"40","adjust-position":!1},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.sendMessage.apply(void 0,arguments)},keyboardheightchange:function(e){arguments[0]=e=t.$handleEvent(e),t.getKeyBoradHeight.apply(void 0,arguments)}},model:{value:t.inputcontent,callback:function(e){t.inputcontent=e},expression:"inputcontent"}})],1)])]),n("uni-icons",{staticStyle:{margin:"0 10px"},attrs:{type:"paperplane",color:"#80E58B",size:"25"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendMessage(t.inputcontent)}}})],1)],1)],1),n("popup",{ref:"micpop",attrs:{maskColor:!1,bottom:!0,bodyBgColor:"bg-white",id:"micpop"},on:{hide:function(e){arguments[0]=e=t.$handleEvent(e),t.micHide.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"col-1",staticStyle:{height:"100%"}},[n("v-uni-view",{staticClass:"flex align-center justify-center text-xl",staticStyle:{height:"20%"}},[t._v(t._s(t.formatedRecordTime))]),n("v-uni-view",{staticClass:"flex align-center justify-center",staticStyle:{height:"50%"}},[n("v-uni-button",{staticClass:"cu-btn cuIcon  shadow",class:t.setButtonBg,staticStyle:{width:"200rpx",height:"200rpx"},attrs:{id:"micbutton"},on:{touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.micTouchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.micTouchEnd.apply(void 0,arguments)},touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.micTouchStart.apply(void 0,arguments)}}},[n("uni-icons",{attrs:{type:"mic",size:"40"}})],1)],1),0==t.isRecording?n("v-uni-view",{staticClass:"flex align-center justify-center text-xl",staticStyle:{height:"20%"}},[t._v("点击录音")]):t._e(),1==t.isRecording?n("v-uni-view",{staticClass:"flex align-center justify-center text-xl",staticStyle:{height:"20%"}},[t._v("向上滑动取消")]):t._e()],1)],1),n("popup",{ref:"tips",attrs:{maskColor:!1,center:!0,bodyBgColor:"bg-white",mask:!1}},[n("v-uni-view",{staticClass:"col-1 radius",staticStyle:{width:"250rpx",height:"250rpx","background-color":"rgba(113,113,113,0.7)"}},[n("v-uni-view",{staticClass:"flex align-center justify-center ",staticStyle:{height:"50%","margin-top":"30rpx"}},[n("uni-icons",{attrs:{type:"refreshempty",size:"60"}})],1),n("v-uni-view",{staticClass:"flex justify-center align-center ",staticStyle:{color:"#ffffff"}},[t._v("松手取消发送")])],1)],1),n("u-popup",{attrs:{mode:"center","border-radius":"60"},model:{value:t.isShowDele,callback:function(e){t.isShowDele=e},expression:"isShowDele"}},[n("v-uni-view",{staticClass:"edit-chat"},[n("v-uni-view",{staticClass:"title"},[t._v("您确定要清除所有聊天记录?")]),n("v-uni-view",{staticClass:"title2"},[t._v("将清空所有对话中的聊天内容，此操作无法恢复。")]),n("v-uni-view",{staticClass:"center"},[n("v-uni-view",{staticClass:"bottom"},[n("v-uni-view",{staticClass:"btn8",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.isShowDele=!1}}},[t._v("取消")]),n("v-uni-view",{staticClass:"btn9",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.save.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],1)],1)},o=[]},"7da3":function(t,e,n){"use strict";n("7a82");var i=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a,o=i(n("c7eb")),r=i(n("1da1"));n("d3b7"),n("159b"),n("e9c4"),n("d401"),n("25f0"),n("14d9");var s={name:"socket-item",props:{socketurl:{type:String,default:""}},data:function(){return{}},mounted:function(){var t=this;this.$nextTick((function(){t.init(t.socketurl)}))},beforeDestroy:function(){a.close()},computed:{},methods:{init:function(t){var e=this;a=uni.connectSocket({url:t,data:function(){return{msg:"Hello"}},success:function(t){},fail:function(t){}}),a.onMessage((function(t){var n=JSON.parse(t.data),i=n.data,a="";switch(a=i.contentType?i.contentType:"image",a){case"text":e.onReciveText(i);break;case"image":e.onReciveImage(i);break;case"audio":e.onReciveAudio(i);break;default:break}}))},onReciveText:function(t){var e=new Date,n={speaker:"Others",text:t.text,contentType:"text",createTime:e.getTime(),isUndo:!1,isDelete:!1};this.$emit("ontext",{data:n})},onReciveImage:function(t){var e=this;t.forEach(function(){var t=(0,r.default)((0,o.default)().mark((function t(n,i){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a="http://47.100.189.197/downloadchat/image/?url="+n.imageSrc,t.next=3,uni.downloadFile({url:a,success:function(t){n.imageSrc=t.tempFilePath;var i={speaker:n.speaker,contentType:n.contentType,imageSrc:n.imageSrc,createTime:n.createTime,isUndo:n.isUndo,isDelete:n.isDelete};e.$emit("onimage",{data:i})}});case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},onReciveAudio:function(t){var e=this,n="http://47.100.189.197/downloadchat/audio/?url="+t.audioSrc;uni.downloadFile({url:n,success:function(n){t.audioSrc=n.tempFilePath,e.$emit("onaudio",{data:t})}})},sendTextMsg:function(t){var e={};e["data"]=t,a.send({data:JSON.stringify(e),success:function(t){},fail:function(t){}})},sendImageMsg:function(t){var e=[],n=[],i=new Date,o={};t.forEach((function(t,e){var i=new Object;i.uri=t,i.name=e.toString(),n.push(i)})),uni.uploadFile({url:"http://47.100.189.197/uploadchat/image/",files:n,formData:{count:t.length,userid:"3"},method:"POST",success:function(t){var n=JSON.parse(t.data),r=n.imageList;r.forEach((function(t,n){var a={speaker:"Others",contentType:"image",imageSrc:t,createTime:i.getTime(),isUndo:!1,isDelete:!1};e.push(a)})),o["data"]=e,a.send({data:JSON.stringify(o),success:function(t){},fail:function(t){}})}})},sendAudioMsg:function(t){var e={};uni.uploadFile({url:"http://47.100.189.197/uploadchat/audio/",filePath:t.audioSrc,name:"audiofile",formData:{userid:"3"},method:"POST",success:function(n){var i=JSON.parse(n.data),o=i.audiopath,r={speaker:"Others",contentType:t.contentType,audioSrc:o,createTime:t.createTime,isUndo:t.isUndo,isDelete:t.isDelete};e["data"]=r,a.send({data:JSON.stringify(e),success:function(t){},fail:function(t){}})}})},sendUndoMsg:function(){}}};e.default=s},"8e19":function(t,e,n){"use strict";n.r(e);var i=n("f94b"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},9041:function(t,e,n){(function(t){var i,a,o,r=n("7037").default;n("d3b7"),n("d9e2"),n("d401"),n("c975"),n("ac1f"),n("5319"),n("fb6a"),n("14d9"),n("e25e"),n("00b4"),n("6c57"),
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
function(n){"use strict";var s=n.setTimeout,c=n.clearTimeout,u=n.XMLHttpRequest,d=n.XDomainRequest,l=n.ActiveXObject,f=n.EventSource,h=n.document,p=n.Promise,v=n.fetch,g=n.Response,m=n.TextDecoder,x=n.TextEncoder,y=n.AbortController;if("undefined"===typeof window||"undefined"===typeof h||"readyState"in h||null!=h.body||(h.readyState="loading",window.addEventListener("load",(function(t){h.readyState="complete"}),!1)),null==u&&null!=l&&(u=function(){return new l("Microsoft.XMLHTTP")}),void 0==Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),Date.now||(Date.now=function(){return(new Date).getTime()}),void 0==y){var w=v;v=function(t,e){var n=e.signal;return w(t,{headers:e.headers,credentials:e.credentials,cache:e.cache}).then((function(t){var e=t.body.getReader();return n._reader=e,n._aborted&&n._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return e}}}}))},y=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){null!=this.signal._reader&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function b(){this.bitsNeeded=0,this.codePoint=0}b.prototype.decode=function(t){function e(t,e,n){if(1===n)return t>=128>>e&&t<<e<=2047;if(2===n)return t>=2048>>e&&t<<e<=55295||t>=57344>>e&&t<<e<=65535;if(3===n)return t>=65536>>e&&t<<e<=1114111;throw new Error}function n(t,e){if(6===t)return e>>6>15?3:e>31?2:1;if(12===t)return e>15?3:2;if(18===t)return 3;throw new Error}for(var i="",a=this.bitsNeeded,o=this.codePoint,r=0;r<t.length;r+=1){var s=t[r];0!==a&&(s<128||s>191||!e(o<<6|63&s,a-6,n(a,o)))&&(a=0,o=65533,i+=String.fromCharCode(o)),0===a?(s>=0&&s<=127?(a=0,o=s):s>=192&&s<=223?(a=6,o=31&s):s>=224&&s<=239?(a=12,o=15&s):s>=240&&s<=247?(a=18,o=7&s):(a=0,o=65533),0===a||e(o,a,n(a,o))||(a=0,o=65533)):(a-=6,o=o<<6|63&s),0===a&&(o<=65535?i+=String.fromCharCode(o):(i+=String.fromCharCode(55296+(o-65535-1>>10)),i+=String.fromCharCode(56320+(o-65535-1&1023))))}return this.bitsNeeded=a,this.codePoint=o,i};void 0!=m&&void 0!=x&&function(){try{return"test"===(new m).decode((new x).encode("test"),{stream:!0})}catch(t){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+t)}return!1}()||(m=b);var T=function(){};function S(t){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=T,this.onload=T,this.onerror=T,this.onreadystatechange=T,this._contentType="",this._xhr=t,this._sendTimeout=0,this._abort=T}function k(t){return t.replace(/[A-Z]/g,(function(t){return String.fromCharCode(t.charCodeAt(0)+32)}))}function C(t){for(var e=Object.create(null),n=t.split("\r\n"),i=0;i<n.length;i+=1){var a=n[i],o=a.split(": "),r=o.shift(),s=o.join(": ");e[k(r)]=s}this._map=e}function _(){}function E(t){this._headers=t}function L(){}function D(){this._listeners=Object.create(null)}function O(t){s((function(){throw t}),0)}function R(t){this.type=t,this.target=void 0}function $(t,e){R.call(this,t),this.data=e.data,this.lastEventId=e.lastEventId}function H(t,e){R.call(this,t),this.status=e.status,this.statusText=e.statusText,this.headers=e.headers}function I(t,e){R.call(this,t),this.error=e.error}S.prototype.open=function(t,e){this._abort(!0);var n=this,i=this._xhr,a=1,o=0;this._abort=function(t){0!==n._sendTimeout&&(c(n._sendTimeout),n._sendTimeout=0),1!==a&&2!==a&&3!==a||(a=4,i.onload=T,i.onerror=T,i.onabort=T,i.onprogress=T,i.onreadystatechange=T,i.abort(),0!==o&&(c(o),o=0),t||(n.readyState=4,n.onabort(null),n.onreadystatechange())),a=0};var r=function(){if(1===a){var t=0,e="",o=void 0;if("contentType"in i)t=200,e="OK",o=i.contentType;else try{t=i.status,e=i.statusText,o=i.getResponseHeader("Content-Type")}catch(r){t=0,e="",o=void 0}0!==t&&(a=2,n.readyState=2,n.status=t,n.statusText=e,n._contentType=o,n.onreadystatechange())}},d=function(){if(r(),2===a||3===a){a=3;var t="";try{t=i.responseText}catch(e){}n.readyState=3,n.responseText=t,n.onprogress()}},l=function(t,e){if(null!=e&&null!=e.preventDefault||(e={preventDefault:T}),d(),1===a||2===a||3===a){if(a=4,0!==o&&(c(o),o=0),n.readyState=4,"load"===t)n.onload(e);else if("error"===t)n.onerror(e);else{if("abort"!==t)throw new TypeError;n.onabort(e)}n.onreadystatechange()}};"onload"in i&&(i.onload=function(t){l("load",t)}),"onerror"in i&&(i.onerror=function(t){l("error",t)}),"onabort"in i&&(i.onabort=function(t){l("abort",t)}),"onprogress"in i&&(i.onprogress=d),"onreadystatechange"in i&&(i.onreadystatechange=function(t){(function(t){void 0!=i&&(4===i.readyState?"onload"in i&&"onerror"in i&&"onabort"in i||l(""===i.responseText?"error":"load",t):3===i.readyState?"onprogress"in i||d():2===i.readyState&&r())})(t)}),!("contentType"in i)&&"ontimeout"in u.prototype||(e+=(-1===e.indexOf("?")?"?":"&")+"padding=true"),i.open(t,e,!0),"readyState"in i&&(o=s((function(){(function t(){o=s((function(){t()}),500),3===i.readyState&&d()})()}),0))},S.prototype.abort=function(){this._abort(!1)},S.prototype.getResponseHeader=function(t){return this._contentType},S.prototype.setRequestHeader=function(t,e){var n=this._xhr;"setRequestHeader"in n&&n.setRequestHeader(t,e)},S.prototype.getAllResponseHeaders=function(){return void 0!=this._xhr.getAllResponseHeaders&&this._xhr.getAllResponseHeaders()||""},S.prototype.send=function(){if("ontimeout"in u.prototype&&("sendAsBinary"in u.prototype||"mozAnon"in u.prototype)||void 0==h||void 0==h.readyState||"complete"===h.readyState){var t=this._xhr;"withCredentials"in t&&(t.withCredentials=this.withCredentials);try{t.send(void 0)}catch(n){throw n}}else{var e=this;e._sendTimeout=s((function(){e._sendTimeout=0,e.send()}),4)}},C.prototype.get=function(t){return this._map[k(t)]},null!=u&&null==u.HEADERS_RECEIVED&&(u.HEADERS_RECEIVED=2),_.prototype.open=function(t,e,n,i,a,o,r){t.open("GET",a);var s=0;for(var c in t.onprogress=function(){var e=t.responseText,i=e.slice(s);s+=i.length,n(i)},t.onerror=function(t){t.preventDefault(),i(new Error("NetworkError"))},t.onload=function(){i(null)},t.onabort=function(){i(null)},t.onreadystatechange=function(){if(t.readyState===u.HEADERS_RECEIVED){var n=t.status,i=t.statusText,a=t.getResponseHeader("Content-Type"),o=t.getAllResponseHeaders();e(n,i,a,new C(o))}},t.withCredentials=o,r)Object.prototype.hasOwnProperty.call(r,c)&&t.setRequestHeader(c,r[c]);return t.send(),t},E.prototype.get=function(t){return this._headers.get(t)},L.prototype.open=function(t,e,n,i,a,o,r){var s=null,c=new y,u=c.signal,d=new m;return v(a,{headers:r,credentials:o?"include":"same-origin",signal:u,cache:"no-store"}).then((function(t){return s=t.body.getReader(),e(t.status,t.statusText,t.headers.get("Content-Type"),new E(t.headers)),new p((function(t,e){(function i(){s.read().then((function(e){if(e.done)t(void 0);else{var a=d.decode(e.value,{stream:!0});n(a),i()}}))["catch"]((function(t){e(t)}))})()}))}))["catch"]((function(t){return"AbortError"===t.name?void 0:t})).then((function(t){i(t)})),{abort:function(){null!=s&&s.cancel(),c.abort()}}},D.prototype.dispatchEvent=function(t){t.target=this;var e=this._listeners[t.type];if(void 0!=e)for(var n=e.length,i=0;i<n;i+=1){var a=e[i];try{"function"===typeof a.handleEvent?a.handleEvent(t):a.call(this,t)}catch(o){O(o)}}},D.prototype.addEventListener=function(t,e){t=String(t);var n=this._listeners,i=n[t];void 0==i&&(i=[],n[t]=i);for(var a=!1,o=0;o<i.length;o+=1)i[o]===e&&(a=!0);a||i.push(e)},D.prototype.removeEventListener=function(t,e){t=String(t);var n=this._listeners,i=n[t];if(void 0!=i){for(var a=[],o=0;o<i.length;o+=1)i[o]!==e&&a.push(i[o]);0===a.length?delete n[t]:n[t]=a}},$.prototype=Object.create(R.prototype),H.prototype=Object.create(R.prototype),I.prototype=Object.create(R.prototype);var j=/^text\/event\-stream(;.*)?$/i,A=function(t,e){var n=null==t?e:parseInt(t,10);return n!==n&&(n=e),M(n)},M=function(t){return Math.min(Math.max(t,1e3),18e6)},U=function(t,e,n){try{"function"===typeof e&&e.call(t,n)}catch(i){O(i)}};function P(t,e){D.call(this),e=e||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,function(t,e,n){e=String(e);var i=Boolean(n.withCredentials),a=n.lastEventIdQueryParameterName||"lastEventId",o=M(1e3),r=A(n.heartbeatTimeout,45e3),l="",f=o,h=!1,p=0,v=n.headers||{},g=n.Transport,m=N&&void 0==g?void 0:new S(void 0!=g?new g:function(){return void 0!=u&&"withCredentials"in u.prototype||void 0==d?new u:new d}()),x=null!=g&&"string"!==typeof g?new g:void 0==m?new L:new _,y=void 0,w=0,b=-1,T="",k="",C="",E="",D=0,O=0,R=0,P=function(e,n,i,a){if(0===b)if(200===e&&void 0!=i&&j.test(i)){b=1,h=Date.now(),f=o,t.readyState=1;var r=new H("open",{status:e,statusText:n,headers:a});t.dispatchEvent(r),U(t,t.onopen,r)}else{var s="";200!==e?(n&&(n=n.replace(/\s+/g," ")),s="EventSource's response has a status "+e+" "+n+" that is not 200. Aborting the connection."):s="EventSource's response has a Content-Type specifying an unsupported type: "+(void 0==i?"-":i.replace(/\s+/g," "))+". Aborting the connection.",z();r=new H("error",{status:e,statusText:n,headers:a});t.dispatchEvent(r),U(t,t.onerror,r),console.error(s)}},B=function(e){if(1===b){for(var n=-1,i=0;i<e.length;i+=1){var a=e.charCodeAt(i);a!=="\n".charCodeAt(0)&&a!=="\r".charCodeAt(0)||(n=i)}var u=(-1!==n?E:"")+e.slice(0,n+1);E=(-1===n?E:"")+e.slice(n+1),""!==e&&(h=Date.now(),p+=e.length);for(var d=0;d<u.length;d+=1){a=u.charCodeAt(d);if(-1===D&&a==="\n".charCodeAt(0))D=0;else if(-1===D&&(D=0),a==="\r".charCodeAt(0)||a==="\n".charCodeAt(0)){if(0!==D){1===D&&(R=d+1);var v=u.slice(O,R-1),g=u.slice(R+(R<d&&u.charCodeAt(R)===" ".charCodeAt(0)?1:0),d);"data"===v?(T+="\n",T+=g):"id"===v?k=g:"event"===v?C=g:"retry"===v?(o=A(g,o),f=o):"heartbeatTimeout"===v&&(r=A(g,r),0!==w&&(c(w),w=s((function(){F()}),r)))}if(0===D){if(""!==T){l=k,""===C&&(C="message");var m=new $(C,{data:T.slice(1),lastEventId:k});if(t.dispatchEvent(m),"open"===C?U(t,t.onopen,m):"message"===C?U(t,t.onmessage,m):"error"===C&&U(t,t.onerror,m),2===b)return}T="",C=""}D=a==="\r".charCodeAt(0)?-1:0}else 0===D&&(O=d,D=1),1===D?a===":".charCodeAt(0)&&(R=d+1,D=2):2===D&&(D=3)}}},V=function(e){if(1===b||0===b){b=-1,0!==w&&(c(w),w=0),w=s((function(){F()}),f),f=M(Math.min(16*o,2*f)),t.readyState=0;var n=new I("error",{error:e});t.dispatchEvent(n),U(t,t.onerror,n),void 0!=e&&console.error(e)}},z=function(){b=2,void 0!=y&&(y.abort(),y=void 0),0!==w&&(c(w),w=0),t.readyState=2},F=function n(){if(w=0,-1===b){h=!1,p=0,w=s((function(){n()}),r),b=0,T="",C="",k=l,E="",O=0,R=0,D=0;var i=e;if("data:"!==e.slice(0,5)&&"blob:"!==e.slice(0,5)&&""!==l){var o=e.indexOf("?");i=-1===o?e:e.slice(0,o+1)+e.slice(o+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,(function(t,e){return e===a?"":t})),i+=(-1===e.indexOf("?")?"?":"&")+a+"="+encodeURIComponent(l)}var c=t.withCredentials,u={Accept:"text/event-stream"},d=t.headers;if(void 0!=d)for(var f in d)Object.prototype.hasOwnProperty.call(d,f)&&(u[f]=d[f]);try{y=x.open(m,P,B,V,i,c,u)}catch(g){throw z(),g}}else if(h||void 0==y){var v=Math.max((h||Date.now())+r-Date.now(),1);h=!1,w=s((function(){n()}),v)}else V(new Error("No activity within "+r+" milliseconds. "+(0===b?"No response received.":p+" chars received.")+" Reconnecting.")),void 0!=y&&(y.abort(),y=void 0)};t.url=e,t.readyState=0,t.withCredentials=i,t.headers=v,t._close=z,F()}(this,t,e)}var N=void 0!=v&&void 0!=g&&"body"in g.prototype;P.prototype=Object.create(D.prototype),P.prototype.CONNECTING=0,P.prototype.OPEN=1,P.prototype.CLOSED=2,P.prototype.close=function(){this._close()},P.CONNECTING=0,P.OPEN=1,P.CLOSED=2,P.prototype.withCredentials=void 0;var B=f;void 0==u||void 0!=f&&"withCredentials"in f.prototype||(B=P),function(n){if("object"===r(t)&&"object"===r(t.exports)){var s=n(e);void 0!==s&&(t.exports=s)}else a=[e],i=n,o="function"===typeof i?i.apply(e,a):i,void 0===o||(t.exports=o)}((function(t){t.EventSourcePolyfill=P,t.NativeEventSource=f,t.EventSource=B}))}("undefined"===typeof globalThis?"undefined"!==typeof window?window:"undefined"!==typeof self?self:this:globalThis)}).call(this,n("62e4")(t))},"9d91":function(t,e,n){"use strict";n.r(e);var i=n("5f08"),a=n("f0eb");for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);var r=n("f0c5"),s=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"e9f1fde4",null,!1,i["a"],void 0);e["default"]=s.exports},bc78:function(t,e,n){var i=n("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 下方引入的为uView UI的集成样式文件，为scss预处理器，其中包含了一些"u-"开头的自定义变量\r\n * 使用的时候，请将下面的一行复制到您的uniapp项目根目录的uni.scss中即可\r\n * uView自定义的css类名和scss变量，均以"u-"开头，不会造成冲突，请放心使用 \r\n */.example1.out[data-v-90369f7c]{width:100%;padding:2px;border-radius:99px;background:linear-gradient(90deg,#b46a80,#739b83)}.example1 .in[data-v-90369f7c]{width:calc(100vw - 70px);width:calc(100% - 20px);height:100%;background:#151520;border-radius:99px}.inputClass[data-v-90369f7c]{background-color:initial;align-content:center;padding:5px 10px 5px 10px;font-size:%?30?%;width:100%}.scrollView[data-v-90369f7c]{position:fixed;right:0;left:0;top:0;\r\n  /* padding-left: 10px;\r\n\t\t\tpadding-right: 10px;\r\n\t\t\tpadding-top: 10px; */width:auto}.bottomClass1[data-v-90369f7c]{padding:10px 12px;background:#151520;border-top-left-radius:20px;border-top-right-radius:20px;display:flex;height:86px;justify-content:flex-start;align-items:center;flex-direction:row}.uni-row[data-v-90369f7c]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.uni-flex[data-v-90369f7c]{display:flex;flex-direction:row;justify-content:flex-start;align-items:center}.s-back[data-v-90369f7c]{background:#1a2134}.index-inp[data-v-90369f7c]{width:100%}.index-inp-inner[data-v-90369f7c]{width:100%;height:36px;color:#fff;padding:0 10px}.index-ml10[data-v-90369f7c]{margin-right:10px}.index-flex-right[data-v-90369f7c]{display:flex;justify-content:flex-end}.index-flex-left[data-v-90369f7c]{display:flex;justify-content:flex-start}.index-no[data-v-90369f7c]{margin-left:12px;margin-top:12px;background:#aa4b4f;display:flex;justify-content:center;align-items:center;padding:0 %?26?%;color:#fff;height:%?60?%;border-radius:%?40?%}.index-mt12[data-v-90369f7c]{margin-top:16px;margin-right:12px}.index-line1[data-v-90369f7c]{padding:12px;display:flex;align-items:center}.index1[data-v-90369f7c]{padding:0;display:flex;justify-content:center;align-items:center;border-radius:20px;background:#e6d08d;color:#5f3d22}.index1-text[data-v-90369f7c]{margin-left:2px;margin-right:10px;font-size:16px}.index2[data-v-90369f7c]{font-size:%?36?%;flex:1;display:flex;justify-content:center}.index3-mr4[data-v-90369f7c]{margin-right:%?16?%}.index-line3[data-v-90369f7c]{display:flex;align-items:center;margin:%?24?%;color:#fff;font-size:%?32?%}.index-line2[data-v-90369f7c]{margin:%?30?% %?24?%;background:#323249;border-radius:10px;padding:%?28?%;color:#a3a3b7;font-size:%?32?%;display:flex;justify-content:space-between;align-items:center}.index-line-mb12[data-v-90369f7c]{margin-bottom:%?60?%}.edit-chat[data-v-90369f7c]{background:rgba(21,21,32,.9);padding:20px}.edit-chat .title[data-v-90369f7c]{color:#fff;font-size:18px;margin-bottom:20px}.edit-chat .title2[data-v-90369f7c]{color:#999;font-size:14px}.edit-chat .bottom[data-v-90369f7c]{margin-top:20px;display:flex;justify-content:space-between;width:300px}.edit-chat .bottom .btn8[data-v-90369f7c]{width:130px;height:36px;background:#edc596;border-radius:%?80?%;border:1px solid #fff;display:flex;justify-content:center;align-items:center;margin-right:%?30?%}.edit-chat .bottom .btn9[data-v-90369f7c]{width:130px;height:36px;background-image:linear-gradient(180deg,#e7b266,#ff8432);border-radius:%?80?%;border:1px solid #fff;display:flex;justify-content:center;align-items:center}',""]),t.exports=e},f0eb:function(t,e,n){"use strict";n.r(e);var i=n("7da3"),a=n.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},f0eb9:function(t,e,n){"use strict";var i=n("1afd"),a=n.n(i);a.a},f94b:function(t,e,n){"use strict";n("7a82");var i=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("14d9"),n("d401"),n("d3b7"),n("25f0"),n("159b"),n("a434"),n("ac1f"),n("e25e");var a,o,r=i(n("c7eb")),s=i(n("1da1")),c=i(n("ade3")),u=n("9041"),d=i(n("ba67")),l=i(n("2361")),f=i(n("b982")),h=i(n("9d91")),p=n("3cbe"),v=i(n("0208")),g=null,m=null,x=(a={name:"easyChat",components:{chatItem:l.default},data:function(){var t;return t={deleIdx:0,isShowDele:!1,pageTitle:"",scrollTopHeight:0,textTemp:"",isLoading:!1,activeIndex:0,socketUrl:"",timeStr:"",clickMic:!1,scrollview:"",inputcontent:"",screenHeight:0,bottomHeight:10,micHeight:255,formatedRecordTime:"00:00:00",recordTime:0,isShowTips:!1,isRecording:!1,isCancel:!1,socketTask:null,form:{},chatList:[]},(0,c.default)(t,"screenHeight",0),(0,c.default)(t,"screenWidth",0),(0,c.default)(t,"statusbarHeight",0),(0,c.default)(t,"_audioContext",null),(0,c.default)(t,"options",{}),(0,c.default)(t,"isVoice",!1),t},onLoad:function(t){var e=this;return(0,s.default)((0,r.default)().mark((function n(){return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$onLaunched;case 2:e.isVoice=uni.getStorageSync("isVoice"),o=e,o.options=t,e.screenWidth=uni.getStorageSync("screenWidth"),e.statusbarHeight=uni.getStorageSync("statusBarHeight"),e.screenHeight=uni.getStorageSync("screenHeight"),o.pageTitle=uni.getStorageSync("pageTitle")||"聊天",uni.setNavigationBarTitle({title:o.pageTitle}),o.getInfo();case 11:case"end":return n.stop()}}),n)})))()},mounted:function(){var t=this;uni.getSystemInfo({success:function(e){t.$nextTick((function(){t.screenHeight=e.windowHeight}))}}),this.$nextTick((function(){g=uni.getRecorderManager(),g.onStart((function(){m=setInterval((function(){t.recordTime+=1,t.formatedRecordTime=t.recordTime}),1e3)})),g.onStop((function(e){if(t.isCancel)t.formatedRecordTime="00:00:00",t.isCancel=!1,t.recordTime=0;else if(t.recordTime<1)t.formatedRecordTime="00:00:00",t.recordTime=0,uni.showToast({icon:"none",title:"发送时间太短",duration:1e3});else{t.recordTime=0;var n=new Date,i={speaker:"Self",contentType:"audio",audioSrc:e.tempFilePath,createTime:n.getTime(),isUndo:!1,isDelete:!1};t.chatList.push(i);var a="dynamic_"+(t.chatList.length-1>-1?t.chatList.length-1:0).toString();t.$nextTick((function(){t.scrollview=a,t.formatedRecordTime="00:00:00"})),t.$refs.socket.sendAudioMsg(i)}}))})),uni.onKeyboardHeightChange((function(e){t.scrollview="null";var n="dynamic_"+(t.chatList.length-1>-1?t.chatList.length-1:0).toString();e.height>0?(t.$nextTick((function(){t.scrollview=n})),t.bottomHeight=e.height):t.$nextTick((function(){t.bottomHeight=10})),console.log(t.bottomHeight,"cccccc")}))}},(0,c.default)(a,"components",{popup:d.default,chatItem:l.default,uniIcons:f.default,socketItem:h.default}),(0,c.default)(a,"computed",{getImageList:function(){var t=[];return this.chatList.forEach((function(e,n){"image"==e.contentType&&t.push(e.imageSrc)}),this),t},getScrollView:function(){return this.scrollview},setButtonBg:function(){return this.isRecording?"bg-blue":"bg-gray"}}),(0,c.default)(a,"methods",{save:function(){var t=this;return(0,s.default)((0,r.default)().mark((function e(){var n;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("content"!=o.options.type){e.next=6;break}return e.next=3,t.$u.api.createDele({model_id:t.options.id});case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,t.$u.api.assistDele({model_id:t.options.id});case 8:n=e.sent;case 9:n&&(t.isShowDele=!1,t.chatList=[],o.getDataList());case 10:case"end":return e.stop()}}),e)})))()},playVoice:function(t){var e=this;return(0,s.default)((0,r.default)().mark((function n(){return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:e._audioContext&&e._audioContext.pause(),e._audioContext=null,e.createAudio(t);case 3:case"end":return n.stop()}}),n)})))()},createAudio:function(t){var e=this._audioContext=uni.createInnerAudioContext();return e.autoplay=!1,e.src=t,this._audioContext.play(),e},getVoice:function(t){return(0,s.default)((0,r.default)().mark((function e(){var n;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.$u.api.chatVoice({content:o.chatList[t].text});case 2:n=e.sent,n&&o.playVoice(n.data);case 4:case"end":return e.stop()}}),e)})))()},goBack:function(){uni.navigateBack({delta:1})},getInfo:function(){return(0,s.default)((0,r.default)().mark((function t(){var e;return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("content"!=o.options.type){t.next=6;break}return t.next=3,o.$u.api.createInfo({id:o.options.id});case 3:e=t.sent,t.next=9;break;case 6:return t.next=8,o.$u.api.assistInfo({id:o.options.id});case 8:e=t.sent;case 9:e&&(o.form=e.data,o.getDataList());case 10:case"end":return t.stop()}}),t)})))()},getDataList:function(){var t=this;return(0,s.default)((0,r.default)().mark((function e(){var n,i,a,s;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("content"!=o.options.type){e.next=6;break}return e.next=3,o.$u.api.createChatList({model_id:o.options.id});case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,o.$u.api.assistChatList({model_id:o.options.id});case 8:n=e.sent;case 9:n&&(i=new Date,a={},n.data.forEach((function(e){a="我"==e.role?{speaker:"Self",contentType:"text",text:e.content,createTime:i.getTime(),isUndo:!1,isDelete:!1}:{speaker:"Others",contentType:"text",text:e.content,createTime:i.getTime(),isUndo:!1,isDelete:!1},t.chatList.push(a)})),0==o.chatList.length&&(s=uni.getStorageSync("welcome"),o.chatList.push({speaker:"Others",contentType:"text",text:o.form.hint_content||s,createTime:i.getTime(),isUndo:!1,isDelete:!1})));case 10:case"end":return e.stop()}}),e)})))()},getData:function(t){var e="".concat(p.host,"/hxai/api/createchat/send?model_id=")+o.options.id+"&message="+t;"content"!=o.options.type&&(e="".concat(p.host,"/hxai/api/rolechat/send?model_id=")+o.options.id+"&message="+t);var n=new u.EventSourcePolyfill(e,{headers:{wid:uni.getStorageSync("wid")||"1",token:uni.getStorageSync("clitoken")||""}});n.onopen=function(t){var e=new Date;o.isLoading=!0;var n={speaker:"Others",contentType:"text",text:"",createTime:e.getTime(),isUndo:!1,isDelete:!1};console.log(o.chatList,"ddddddd"),o.chatList.push(n);(o.chatList.length-1>-1?o.chatList.length-1:0).toString();o.$nextTick((function(){o.scrollToBottom()}))},n.onmessage=function(t){(o.chatList.length-1>-1?o.chatList.length-1:0).toString();o.$nextTick((function(){o.textTemp+=t.data,console.log(o.textTemp,"fffff"),o.scrollToBottom()}))},n.onerror=function(t){var e=new Date;n.close(),o.chatList.splice(o.chatList.length-1,1);var i={speaker:"Others",contentType:"text",text:o.textTemp,createTime:e.getTime(),isUndo:!1,isDelete:!1};o.chatList.push(i);(o.chatList.length-1>-1?o.chatList.length-1:0).toString();o.$nextTick((function(){o.textTemp="",o.isLoading=!1,o.scrollToBottom()}))}},scrollToBottom:function(){var t=this;uni.createSelectorQuery().in(o).select("#scroll-view-content").boundingClientRect((function(e){var n=e.height-(o.screenHeight-o.bottomHeight-140);n>0&&(t.scrollTopHeight=n)})).exec()},subscribe:function(){uni.navigateTo({url:"/pages/subscribe/subscribe"})},readmethod:function(){},longpressmethod:function(t){var e=this,n=(t.target.id,0),i=0;uni.createSelectorQuery().in(this).select("#test1").boundingClientRect((function(t){var a=t.left,o=t.right;i=(a+o)/2,n=t.top,e.$refs.popup.show(i,n)})).exec()},computeDate:function(t,e){if(t){var n=new Date;if(e>0){var i=this.chatList[e-1].createTime;if(t-i>6e4){n.setTime(t);var a=n.toString(),o=a.split(" ")[4];return o}return""}return""}return""},setDatetimeStyle:function(t,e){if(t){if(e>0){var n=this.chatList[e-1].createTime;return t-n>6e4?"justify-content: center;align-content: center;margin-bottom: 25rpx;font-size: 25rpx;":""}return""}return""},sendMessage:function(t){var e=this;return(0,s.default)((0,r.default)().mark((function n(){var i,a,s,c,u;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(v.default.userInfo){n.next=3;break}return uni.navigateTo({url:"/pages/login/login"}),n.abrupt("return");case 3:if(i="",i="string"==typeof t?t:t.detail.value,a=new Date,!i||e.isLoading){n.next=11;break}return n.next=9,e.$u.api.chatCheck({text:i,type:"content"==o.options.type?"createchat":"rolechat",model_id:o.options.id});case 9:s=n.sent,s&&(1!=s.data.code?(c={speaker:"Self",contentType:"text",text:s.data.text,createTime:a.getTime(),isUndo:!1,isDelete:!1},e.chatList.push(c),u="dynamic_"+(e.chatList.length-1>-1?e.chatList.length-1:0).toString(),e.$nextTick((function(){e.inputcontent="",e.scrollview=u})),e.getData(s.data.text)):(e.$nextTick((function(){e.inputcontent="",e.scrollview=id})),e.$u.toast(s.data.text)));case 11:case"end":return n.stop()}}),n)})))()},checkPermission:function(){return(0,s.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",1);case 1:case"end":return t.stop()}}),t)})))()},micClick:function(){return(0,s.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},imageClick:function(){var t=this,e=new Date,n=[];uni.chooseImage({sourceType:["album"],count:6,success:function(i){var a=i.tempFilePaths;a.forEach((function(i,a){var o={speaker:"Self",contentType:"image",imageSrc:i,createTime:e.getTime(),isUndo:!1,isDelete:!1};t.chatList.push(o),n.push(i)})),setTimeout((function(){var e="dynamic_"+(t.chatList.length-1>-1?t.chatList.length-1:0).toString();t.scrollview=e}),500),t.$refs.socket.sendImageMsg(n)},fail:function(t){}})},cameraClick:function(){var t=this,e=new Date;uni.chooseImage({sourceType:["camera"],success:function(n){var i=n.tempFilePaths;i.forEach((function(n,i){var a={speaker:"Self",contentType:"image",imageSrc:n,createTime:e.getTime(),isUndo:!1,isDelete:!1};t.chatList.push(a)})),setTimeout((function(){var e="dynamic_"+(t.chatList.length-1>-1?t.chatList.length-1:0).toString();t.scrollview=e}),500)},fail:function(t){}})},getKeyBoradHeight:function(t){},micHide:function(){this.bottomHeight=0,this.clickMic=!1},micTouchStart:function(t){this.isRecording=!0,g.start({format:"mp3"})},micTouchMove:function(t){var e=this.screenHeight-this.bottomHeight+t.currentTarget.offsetTop;t.touches[0].clientY<e&&!this.isShowTips&&(this.isCancel=!0,this.isShowTips=!0,this.$refs.tips.show()),t.touches[0].clientY>=e&&(this.isCancel=!1,this.isShowTips=!1,this.$refs.tips.hide())},micTouchEnd:function(t){this.isRecording=!1,clearInterval(m),g.stop(),this.$refs.tips.hide()},undo:function(t){var e=parseInt(t.index);this.chatList[e].isUndo=!0,console.log(this.scrollview)},deleted:function(t){this.deleIdx=parseInt(t),this.isShowDele=!0},onReciveMessages:function(t){},ontext:function(t){var e=this,n=t.data;this.chatList.push(n);var i="dynamic_"+(this.chatList.length-1>-1?this.chatList.length-1:0).toString();this.$nextTick((function(){e.scrollview=i}))},onimage:function(t){var e=this,n=t.data;this.chatList.push(n);var i="dynamic_"+(this.chatList.length-1>-1?this.chatList.length-1:0).toString();setTimeout((function(){e.scrollview=i}),500)},onaudio:function(t){var e=this,n=t.data;this.chatList.push(n);var i="dynamic_"+(this.chatList.length-1>-1?this.chatList.length-1:0).toString();setTimeout((function(){e.scrollview=i}),500)}}),a);e.default=x}}]);